<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>HLS over IPFS video player</title>
    <link rel="icon" href="favicon.ico" />
    <style>
      * {
        box-sizing: border-box;
      }
      html,
      body {
        padding: 0;
        margin: 0;
      }
      body {
        font-family: sans-serif;
        color: white;
        background-color: black;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      code {
        white-space: nowrap;
      }
      #status {
        font-size: 2em;
        text-align: center;
        transition: transform 0.3s 1s ease;
        position: fixed;
        bottom: 100%;
        left: 0;
        width: 100%;
        height: 3ex;
        margin-bottom: -3ex;
      }
      .is-hiding {
        transform: translateY(-3ex);
      }
      #video {
        display: none;
        width: 100%;
        height: 100%;
      }
      #help {
        max-width: 80ch;
        padding: 5em;
      }
      pre {
        background-color: #ffffff1f;
        padding: 0.5em;
        overflow: auto;
      }
      #contextMenu {
        position: sticky;
        background-color: #2f2f2faf;
        color: white;
        width: 20em;
      }
      #contextMenu > div {
        border: 1px solid #0000007f;
        cursor: pointer;
        padding: 0.5em;
      }
      #contextMenu > div + div {
        border-top: none;
      }
      #contextBackground {
        position: fixed;
        bottom: 0;
        right: 0;
        height: 100%;
        width: 100%;
      }
      .is-hidden {
        display: none;
      }
    </style>

    <script type="module" defer="" src="./src/index.js"></script>
  </head>
  <body>
    <video id="video" controls="" controlsList="nodownload" autoplay=""></video>
    <div id="status"></div>
    </div>
    <div class="is-hidden" id="contextBackground">
      <div id="contextMenu">
        <div id="contextMenu-url">Copy video URL</div>
        <div id="contextMenu-urlWithTime">Copy video URL at current time</div>
      </div>
    </div>
    <section id="help">
      <h1>HLS over IPFS video player</h1>
      <h2 id="how-to-use">
        <a class="anchor" href="#how-to-use"></a>How to use:
      </h2>
      <p>Accepts three query parameters:</p>
      <ul>
        <li>
          <code>hash</code>: required. The IPFS hash of a folder containing an
          HLS playlist and its files.
        </li>
        <li>
          <code>source</code>: optional, defaults to <code>master.m3u8</code>.
        </li>
        <li>
          <code>title</code>: optional, allows overriding the browser tab title.
        </li>
        <li><code>time</code>: optional, start the video at this many seconds</li>
      </ul>
      <h2 id="usage-examples">
        <a class="anchor" href="#usage-examples"></a>Usage Examples:
      </h2>
      <ul>
        <li>
          <a
            href="https://ipfsvideo.cc/?hash=QmdpAidwAsBGptFB3b6A9Pyi5coEbgjHrL3K2Qrsutmj9K&title=Big%20Buck%20Bunny"
            >Big Buck Bunny</a
          >
        </li>
        <li>
          <a
            href="https://ipfsvideo.cc/?hash=QmYzdc44xBkVgp8aWJW57KprjDs5j2hmN8g7eDqm5pvY8L&title=What+is+the+Royal+Path%3F+-+Royal+Path+001"
            >What is the Royal Path? - Royal Path 001</a
          >
        </li>
      </ul>
      <h2 id="how-to-make-compatible-videos">
        <a class="anchor" href="#how-to-make-compatible-videos"></a>How to make
        compatible videos:
      </h2>
      <p>
        Here is a Bash script you can use to encode a video into a HLS folder
        with a playlist:
      </p>
      <pre>#!/usr/bin/env bash
outdir=${1%.*}
mkdir &quot;$outdir&quot;
pushd &quot;$outdir&quot;
ffmpeg -i &quot;../$1&quot; -profile:v baseline -level 3.0 -start_number 0 -hls_time 5 -hls_list_size 0 -f hls master.m3u8
popd</pre>
      <p>
        (If you add that to your path as <code>recode-to-hls</code> you can
        convert a folder of MP4 files with the command
        <code>ls *.mp4 -1 | xargs -d &quot;\n&quot; -n1 recode-to-hls</code>.)
      </p>
      <p>
        A folder produced this way can be posted to IPFS, and that hash is used
        in this page URL. Here are two hashes created following this format:
      </p>
      <ul>
        <li>
          <code>QmdpAidwAsBGptFB3b6A9Pyi5coEbgjHrL3K2Qrsutmj9K</code> - Big Buck
          Bunny
        </li>
        <li>
          <code>QmYzdc44xBkVgp8aWJW57KprjDs5j2hmN8g7eDqm5pvY8L</code> - Royal
          Path episode 001
        </li>
      </ul>
      <noscript>
        <p>
          <strong
            >Since your browser is not executing JavaScript, none of this will
            work.</strong
          >
        </p>
      </noscript>
    </section>
  </body>
</html>
